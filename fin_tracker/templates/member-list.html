{% extends 'index.html' %}
{% load static %}
{% block head %}
<title>{% block title %}Member List{% endblock title %}</title>
{% endblock head %}
{% block body %}

<div class="container py-4">
    <h2 class="mb-4"><a href="{% url 'home'%}" style='text-decoration:none;'>Home < </a>Member List</h2>

    <!--Add member and department-->
    {% if request.user.is_superuser %}
    <div style="margin-bottom: 20px;">
        {% if perms.fin_tracker.add_member %}
        <a href="{% url 'create-member' %}" class="btn btn-primary">âž• Add Member</a>
        {% endif %}
    </div>
    {% endif %}

    <!-- Filter Form -->
    <form method="GET" class="row g-3 mb-4 bg-white p-3 rounded shadow-sm">
        <div class="col-md-3">
            <input type="text" name="name" class="form-control" placeholder="Search by Name">
        </div>

        <div class="col-md-2">
            <input type="number" name="roll" class="form-control" placeholder="Roll">
        </div>

        <div class="col-md-2">
            <select name="department" class="form-select">
                <option value="">All Departments</option>
                {% for dept in departments %}
                    <option value="{{dept.id}}">{{dept.name}}</option>
                {% endfor %}
            </select>
        </div>

        <div class="col-md-2">
            <select name="semester" class="form-select">
                <option value="">All Semesters</option>
                {% for sem in semesters %}
                    <option value="{{sem}}">{{sem}}</option>
                {% endfor %}
            </select>
        </div>

        <div class="col-md-2">
            <select name="shift" class="form-select">
                <option value="">All Shift</option>
                {% for shift in shift_list %}
                    <option value="{{shift}}">{{shift}}</option>
                {% endfor %}
            </select>
        </div>

        <div class="col-md-1 d-grid">
            <button type="submit" class="btn btn-primary">Filter</button>
        </div>
    </form>

    <!-- Member Table -->
    <div class="table-responsive bg-white shadow-sm rounded">
        <table class="table table-bordered table-hover mb-0">
            <thead class="table-light">
                <tr>
                    <th>Name</th>
                    <th>Roll</th>
                    <th>Department</th>
                    <th>Semester</th>
                    <th>Shift</th>
                    <th>Joined At</th>
                    <th>Detail</th>
                </tr>
            </thead>
            <tbody>
                {% for member in members %}
                    <tr>
                        <td><a href="{% url 'member-detail' member.id %}" style="text-decoration:none;">{{ member.name }}</a></td>
                        <td>{{ member.roll }}</td>
                        <td>{{ member.department.name }}</td>
                        <td>{{ member.semester }}</td>
                        <td>{{ member.shift }}</td>
                        <td>{{ member.joined_at|date:"Y-m-d" }}</td>
                        <td><a href="{% url 'member-detail' member.id %}" class='btn btn-primary'>View</a></td>
                    </tr>
                {% empty %}
                    <tr>
                        <td colspan="5" class="text-center text-muted">No members found.</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

{% endblock body %}